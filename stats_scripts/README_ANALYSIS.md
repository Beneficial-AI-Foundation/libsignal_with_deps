# LibSignal Dependency Analysis

This directory contains Python scripts to analyze function dependencies between the `rust/` codebase and the `deps/` directory using the `libsignal_with_deps.json` file.

## Generated Files

1. **`analyze_deps.py`** - Main analysis script that provides comprehensive statistics
2. **`extended_analysis.py`** - Extended analysis with operation patterns and module breakdowns
3. **`visualize_deps.py`** - Simple text-based visualization of dependency usage
4. **`generate_report.py`** - Generates a markdown summary report
5. **`dependency_analysis.json`** - Raw analysis data (generated by analyze_deps.py)
6. **`DEPENDENCY_REPORT.md`** - Human-readable summary report

## Key Findings

### Overall Statistics
- **75 Rust functions** make calls to dependency functions
- **136 unique dependency functions** are called from deps/
- **33 Rust files** use dependencies
- **232 total dependency calls** across the codebase

### Top Dependencies
1. `ct_eq` (subtle) - 13 calls - Constant-time equality for security
2. `from_curve_name` (boring-signal) - 6 calls - Elliptic curve initialization
3. `sha256` (boring-signal) - 5 calls - SHA-256 hashing
4. `serial_number` (boring-signal) - 5 calls - X.509 certificate operations

### Crate Usage
- **boring-signal**: 205 calls (88.4%) - Primary cryptographic operations
- **subtle**: 26 calls (11.2%) - Constant-time operations for security
- **ctr**: 1 call (0.4%) - Counter mode encryption

### Most Dependent Modules
- `rust/attest/` - Heavy user of certificate and cryptographic functions
- `rust/device-transfer/` - Uses encryption and security functions
- `rust/net/` - Network security and TLS operations
- `rust/crypto/` - Core cryptographic operations

## Usage

Run the scripts in this order:

```bash
# Generate comprehensive analysis
python3 analyze_deps.py

# Get extended insights
python3 extended_analysis.py

# Create visualizations
python3 visualize_deps.py

# Generate final report
python3 generate_report.py
```

## Insights

1. **Security Focus**: Heavy use of constant-time operations (`subtle`) shows attention to timing attack resistance
2. **Crypto Centralization**: `boring-signal` (BoringSSL wrapper) is the primary crypto provider
3. **Attestation Heavy**: Certificate and attestation modules are the biggest dependency users
4. **Modular Design**: Different Rust modules use different subsets of dependencies appropriately

## Technical Notes

- Analysis is based on function call relationships tracked in `libsignal_with_deps.json`
- Only direct function calls are analyzed (not macro expansions or generic instantiations)
- Text analysis of function bodies provides additional context for crate usage patterns
